<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>video system</title>
  <style>
body {
    color: black;
    background-color: black;
}
button {
  font-size:18px;
  background-color: black;
  color: LimeGreen;
}
#firstpage {
  float: left;
  width: 250px;
  height: 900px;
  visibility: hidden;
  background-color: black;
}
#secondpage {
  width: 1850px;
  height: 900px;
  background-color: black;
}
</style>
</head>
<body>
  <div id="firstpage">
  <form name="numPad">
  <table cellpadding="2" cellspacing="2" border="0">
  <tr>
       <td colspan="3" align="center"><input type="text" name="quantity" size="20"></td>
  </tr>
  <tr>
       <td><input type="button" value="1" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="2" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="3" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
  </tr>
  <tr>
       <td><input type="Button" value="4" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="5" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="6" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
  </tr>
  <tr>
       <td><input type="Button" value="7" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="8" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="9" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
  </tr>
  <tr>
       <td><input type="Button" value="C" style="font-size:25px;" onclick = "document.numPad.quantity.value = ''"></td>
       <td><input type="Button" value="0" style="font-size:25px;" onclick = "document.numPad.quantity.value += this.value"></td>
       <td><input type="Button" value="OK" style="font-size:25px;" onclick = CodeCheck()></td>
  </tr>
  </table>
  </form>
  <p><button type="Button" onclick="Archive()">Archive</button><br><br>
  <button id="stream" type="Button" onclick="Stream()" style="visibility: hidden;">Live Stream</button><br><br>
  <button id="airing" type="Button" onclick="OpenVent()" style="visibility: hidden;">Ventilation</button></p>
  </div>
  <div id="secondpage"><p><img src="./pic/warning.gif"/></p></div>
<script>

var myVar = setInterval(myTimer, 1500);
var runOnceFlag1 = 1;
var runOnceFlag2 = 1;
var runOnceFlag3 = 1;
var myObjHint;
var myVideoURL = {video2:"/video/video2.mp4", video3:"/video/video3.mp4", video4:"/video/video4.mp4", video5:"/video/video5.mp4"};
var myVideoShow = {video2:"Yes", video3:"No", video4:"No", video5:"No"};
document.addEventListener('contextmenu', event => event.preventDefault());

function myTimer() {
  loadDoc("http://adminpiwnica:8080/scripts/get_currentmove.pl", prepare_output);
}

function loadDoc(url, cFunction) {
  var jsonhttp=new XMLHttpRequest();
  jsonhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      cFunction(this);
    }
  };
  jsonhttp.open("GET", url, true);
  jsonhttp.send();
}

function prepare_output(jsonhttp) {
  myObjHint = JSON.parse(jsonhttp.responseText);
  if (myObjHint.currentstep == "5") {
    if (runOnceFlag1) {
      document.getElementById("secondpage").innerHTML = "<button type='Button' onclick='DrawMe()' style='border: 0;padding: 0'><img src='./pic/fingerprint.jpg' style='height:600px;'></button>";
      runOnceFlag1 = 0;
    }
  } else if (myObjHint.currentstep == "10") {
    if (runOnceFlag2) {
      myVideoShow.video4 = "Yes";
      PlayMe("video4");
      runOnceFlag2 = 0;
    }
  } else if (myObjHint.currentstep == "25") {
    if (runOnceFlag3) {
      document.getElementById("airing").style.visibility = "visible";
      runOnceFlag3 = 0;
    }
  }
}

function continueRefresh() {
  myVar = setInterval(myTimer, 1500);
  document.getElementById("firstpage").innerHTML = "";
}

function DrawMe() {
  if (myObjHint.movement == "Clear") {
    document.getElementById("firstpage").style.visibility = "visible";
    document.getElementById("secondpage").innerHTML = "";
  } else {
    window.alert("Intruders in the outer perimeter were detected!");
  }
}

function Stream() {
  document.getElementById("secondpage").innerHTML = "<img src='http://piwnica:9090/?action=stream'>";
}

function Archive() {
  document.getElementById("secondpage").innerHTML = "";
  for (var vid in myVideoShow) {
    //console.log(vid + " " + myVideoShow[vid]);
    if (myVideoShow[vid] == "Yes") {
      document.getElementById("secondpage").innerHTML += "<button type='Button' onclick='PlayMe(\"" + vid +"\")'><img src='/pic/" + vid +".png'></button><br>";
    }
  }
}

function CodeCheck() {
  if (document.numPad.quantity.value == "111") {
    myVideoShow.video3 = "Yes";
    PlayMeAndOpen("video3");
  } else if (document.numPad.quantity.value == "222") {
    document.getElementById("stream").style.visibility = "visible";
    loadDoc("http://adminpiwnica:8080/scripts/opencombox.pl", dummy);
    Stream();
  } else if (document.numPad.quantity.value == "333") {
    myVideoShow.video5 = "Yes";
    PlayMeAndTurn("video5");
  } else if (document.numPad.quantity.value == "444") {
    loadDoc("http://adminpiwnica:8080/scripts/turnprojector.pl", dummy);
  }
  document.numPad.quantity.value = "";
}

function PlayMe(AcseptedToPlay) {
  document.getElementById("secondpage").innerHTML = "<video width='1600' height='900' autoplay><source src='" + myVideoURL[AcseptedToPlay] + "' type='video/mp4'></video>";
}
function PlayMeAndOpen(AcseptedToPlay) {
  document.getElementById("secondpage").innerHTML = "<video width='1600' height='900' autoplay onended='OpenTable()'><source src='" + myVideoURL[AcseptedToPlay] + "' type='video/mp4'></video>";
}
function PlayMeAndTurn(AcseptedToPlay) {
  document.getElementById("secondpage").innerHTML = "<video width='1600' height='900' autoplay onended='TurnOnLight()'><source src='" + myVideoURL[AcseptedToPlay] + "' type='video/mp4'></video>";
}
function OpenTable() {
  loadDoc("http://adminpiwnica:8080/scripts/opentable.pl", dummy);
}
function TurnOnLight() {
  loadDoc("http://adminpiwnica:8080/scripts/turnonlight.pl", dummy);
  loadDoc("http://adminpiwnica:8080/scripts/put_sig.pl?FNS=1",dummy);
}
function OpenVent() {
  loadDoc("http://adminpiwnica:8080/scripts/openvent.pl", dummy);
}
function dummy(jsonhttp) {
}
</script>
</body>
</html>
