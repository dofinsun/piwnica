<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Management page</title>
	<script type="text/javascript" src="scripts/md5.js"></script>
</head>
<body>
	<div id="firstpage">
		<input type="password" id="GameStartPassword">
		<select id="Players" required>
		  <option value="3">3 players</option>
		  <option value="4">4 players</option>
		  <option value="5">5 players</option>
		  <option value="6">6 players</option>
		</select>
		<button type="Button" id="StartButton" onclick="GameStart()">Start</button>
	</div>
	<p id="demo"></p>

<script>

	function myTimer() {
		var d = new Date();
		var t = d.toLocaleTimeString();
		document.getElementById("demo").innerHTML = t;
		loadDoc("scripts/get_gamestat.pl", myFunction);
	}

	function GameStart() {
		if (md5(document.getElementById("GameStartPassword").value) === "d8578edf8458ce06fbc5bb76a58c5ca4") {
			document.getElementById("StartButton").disabled = true;
			document.getElementById("demo").innerHTML = "Ok";
			loadDoc("scripts/starthegame.pl?Players=" + document.getElementById("Players").value, myFunction);
			var myVar = setInterval(myTimer, 5000);
		} else {
			window.alert("Wrong password!!!");
		}
	}

	function loadDoc(url, cFunction) {
	  var jsonhttp=new XMLHttpRequest();
	  jsonhttp.onreadystatechange = function() {
	    if (this.readyState == 4 && this.status == 200) {
	      cFunction(this);
	    }
	  };
	  jsonhttp.open("GET", url, true);
	  jsonhttp.send();
	}

	function myFunction(jsonhttp) {
		var txt = "";
		var tab;
		var row;
		var rightorder = { RuStat:"", GameStat:"", SensorStat:""}
		document.getElementById("firstpage").innerHTML = "Get from DB: <br>";
		var myObjData = JSON.parse(jsonhttp.responseText);
		for (tab in rightorder) {
			myObjData[tab].sort(function(a, b){
			        var x = a.Param.toLowerCase();
			        var y = b.Param.toLowerCase();
			        if (x < y) {return -1;}
			        if (x > y) {return 1;}
			        return 0;
						});
			txt = "<table><tr><th>Param</th><th>Value</th></tr>";
			for (row in myObjData[tab]){
				txt += "<tr><td>" + myObjData[tab][row].Param + "</td><td>" + myObjData[tab][row].Value + "</td></tr>";
			}
			document.getElementById("firstpage").innerHTML += txt;
			document.getElementById("firstpage").innerHTML += "</table>";
		}
	}
</script>
</body>
</html>
